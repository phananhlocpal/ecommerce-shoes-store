{"ast":null,"code":"import axios from 'axios';\nimport { variables } from './variables.js';\nimport jwtDecode from 'jwt-decode';\nconst API_URL = variables.CUSTOMER_API;\nconst API_URL_AUTHEN = variables.AUTHEN_API;\nconst getUsers = async () => {\n  const response = await axios.get(API_URL);\n  return response.data;\n};\nconst getUser = async userId => {\n  const response = await axios.get(`${API_URL}/${userId}`);\n  return response.data;\n};\nconst createUser = async user => {\n  const response = await axios.post(API_URL, user);\n  return response.data;\n};\nconst updateUser = async (userId, user) => {\n  const response = await axios.put(`${API_URL}/${userId}`, user);\n  return response.data;\n};\nconst deleteUser = async userId => {\n  const response = await axios.delete(`${API_URL}/${userId}`);\n  return response.data;\n};\nconst getCartByUserId = async userId => {\n  try {\n    const response = await axios.get(`${API_URL_CART}/${userId}`);\n    return response.data; // Giả sử response trả về object chứa cartId\n  } catch (error) {\n    console.error('Error fetching cart:', error);\n    return null;\n  }\n};\nconst login = async loginData => {\n  try {\n    const response = await axios.post(`${API_URL_AUTHEN}/login-customer`, loginData);\n    if (response.data.token) {\n      // Lưu thông tin người dùng vào localStorage\n      localStorage.setItem('user', JSON.stringify(response.data));\n\n      // Lấy userId từ response và lấy cartId của người dùng\n      const userId = response.data.id;\n      const cart = await getCartByUserId(userId); // Lấy cartId thông qua userId\n\n      if (cart) {\n        const cartId = cart.id; // Giả sử cart có thuộc tính 'id'\n        // Lưu cartId vào localStorage hoặc redux state nếu cần\n        localStorage.setItem('cartId', cartId);\n      }\n      return {\n        userId,\n        cartId: cart ? cart.id : null\n      }; // Trả về userId và cartId\n    }\n\n    return {\n      token: null\n    };\n  } catch (error) {\n    if (error.response && error.response.status === 401) {\n      alert('Invalid email or password');\n    } else {\n      alert('An error occurred');\n    }\n    return {\n      token: null\n    };\n  }\n};\nexport default {\n  login,\n  getUser,\n  getUsers,\n  createUser,\n  updateUser,\n  deleteUser\n};","map":{"version":3,"names":["axios","variables","jwtDecode","API_URL","CUSTOMER_API","API_URL_AUTHEN","AUTHEN_API","getUsers","response","get","data","getUser","userId","createUser","user","post","updateUser","put","deleteUser","delete","getCartByUserId","API_URL_CART","error","console","login","loginData","token","localStorage","setItem","JSON","stringify","id","cart","cartId","status","alert"],"sources":["C:/Users/Surface/Documents/Pal/myproject/ecommerce-app-ms-sql-net-react-main/frontend/src/utils/api/userApi.js"],"sourcesContent":["import axios from 'axios';\nimport { variables } from './variables.js';\nimport jwtDecode from 'jwt-decode';\n\nconst API_URL = variables.CUSTOMER_API\nconst API_URL_AUTHEN = variables.AUTHEN_API\n\nconst getUsers = async () => {\n  const response = await axios.get(API_URL);\n  return response.data;\n}\n\nconst getUser = async (userId) => {\n  const response = await axios.get(`${API_URL}/${userId}`);\n  return response.data;\n}\n\nconst createUser = async (user) => {\n  const response = await axios.post(API_URL, user);\n  return response.data;\n}\n\nconst updateUser = async (userId, user) => {\n  const response = await axios.put(`${API_URL}/${userId}`, user);\n  return response.data;\n}\n\nconst deleteUser = async (userId) => {\n  const response = await axios.delete(`${API_URL}/${userId}`);\n  return response.data;\n}\n\nconst getCartByUserId = async (userId) => {\n  try {\n    const response = await axios.get(`${API_URL_CART}/${userId}`);\n    return response.data; // Giả sử response trả về object chứa cartId\n  } catch (error) {\n    console.error('Error fetching cart:', error);\n    return null;\n  }\n};\n\nconst login = async (loginData) => {\n  try {\n    const response = await axios.post(`${API_URL_AUTHEN}/login-customer`, loginData);\n    if (response.data.token) {\n      // Lưu thông tin người dùng vào localStorage\n      localStorage.setItem('user', JSON.stringify(response.data));\n\n      // Lấy userId từ response và lấy cartId của người dùng\n      const userId = response.data.id;\n      const cart = await getCartByUserId(userId); // Lấy cartId thông qua userId\n\n      if (cart) {\n        const cartId = cart.id; // Giả sử cart có thuộc tính 'id'\n        // Lưu cartId vào localStorage hoặc redux state nếu cần\n        localStorage.setItem('cartId', cartId);\n      }\n      \n      return { userId, cartId: cart ? cart.id : null }; // Trả về userId và cartId\n    }\n    return { token: null };\n  } catch (error) {\n    if (error.response && error.response.status === 401) {\n      alert('Invalid email or password');\n    } else {\n      alert('An error occurred');\n    }\n    return { token: null };\n  }\n};\n\nexport default {\n  login,\n  getUser,\n  getUsers,\n  createUser,\n  updateUser,\n  deleteUser\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}